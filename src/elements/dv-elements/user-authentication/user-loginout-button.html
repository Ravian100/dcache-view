<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">

<link rel="import" href="user-login-page.html">
<dom-module id="user-loginout-button">
    <style>
        :host {
            @apply(--layout-horizontal);
        }
        .capitalize {
            text-transform: initial !important;
            font-size: 0.7em;
            padding-left: 5px;
        }
    </style>
    <template>
        <paper-button on-tap="_loginout">
            <iron-icon icon="{{icon}}"></iron-icon>
            <label class="capitalize">{{msg}}</label>
        </paper-button>
    </template>
    <script>
        UserLoginoutButton = Polymer({
            is: 'user-loginout-button',
            properties: {
                msg: {
                    type: String,
                    notify: true
                },

                icon: {
                    type: String,
                    notify: true
                },

                upauth: {
                    type: String,
                    value: function () {
                        // TODO: Add functionality to support storing auth for longer period
                        return sessionStorage.upauth;
                    },
                    notify: true
                }
            },

            /**
             * Element Constructor
             */
            factoryImpl: function() {},

            attached: function()
            {
                if( typeof(Storage) !== "undefined" ) {
                    // Code for sessionStorage.
                    if ( this.upauth == null || this.upauth == "" || this.upauth == undefined ) {
                        /*continue to be nobody*/
                        this.icon = "exit-to-app";
                        this.msg = "Log-in";
                    } else {
                        this.icon = "social:person";
                        this.msg = "Log-out";
                    }
                } else {
                    app.$.toast.text = 'Sorry! No Web Storage support... ';
                    app.$.toast.show();
                }
            },

            /**
             * EventHandler (Functions)
             *  ============================
             */
            _loginout: function() {
                //e.stopPropagation();
                if (this.upauth == null || this.upauth == "" || this.upauth == undefined ) {
                    //log-in
                    var vf;
                    if (app.route == "home"){
                       vf = app.$.homeDir;
                    } else if(app.route == "pathfinder") {
                        vf = app.$.pathFinder;
                    }
                    var content = vf.querySelector('#content');
                    var moreMessage = "If you have an account, enter your User Name and Password.";
                    content.innerHTML = "";
                    var ulp = new UserLoginPage(moreMessage);
                    content.appendChild(ulp);
                    Polymer.dom.flush();
                    this.updateStyles();
                } else {
                    //log-out
                    sessionStorage.removeItem("upauth");
                    this.icon = "social:person";
                    this.msg = "Log-out";
                    this.upauth = null;
                    Polymer.dom.flush();
                    this.updateStyles();
                    window.location.reload();
                }
                //e.stopPropagation();
            },
        });
    </script>
</dom-module>