<link rel="import"
      href="../../../../bower_components/polymer/polymer-element.html">
<link rel="import"
      href="../../../../bower_components/iron-pages/iron-pages.html">
<link rel="import"
      href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import"
      href="../../../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import"
      href="../../../../bower_components/paper-input/paper-input.html">
<link rel="import"
      href="../../../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import"
      href="../../../../bower_components/paper-tabs/paper-tab.html">
<link rel="import"
      href="../../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import"
      href="../../../../bower_components/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import"
      href="../../../../bower_components/vaadin-grid/vaadin-grid-filter.html">
<link rel="import"
      href="../../../../bower_components/vaadin-grid/vaadin-grid-column-group.html">
<link rel="import"
      href="../../../../bower_components/vaadin-grid/vaadin-grid-table-scroll-behavior.html">
<link rel="import"
      href="../../../../bower_components/vaadin-grid/vaadin-grid-cell-click-behavior.html">
<link rel="import"
      href="../../../../elements/dv-elements/admin/dialogs/file-info-dialog.html">
<link rel="import"
      href="../../../../elements/dv-elements/admin/dialogs/pool-info-dialog.html">
<link rel="import"
      href="../../../../elements/dv-elements/admin/dv-admin-mixins.html">

<dom-module id="pool-activity-dialog">
    <template>
        <style>
            :host {
                display: none;
                @apply(--layout-vertical);
                height: 100%;
                width: 90%;
                -webkit-font-smoothing: antialiased;
            }

            paper-toolbar {
                color: var(--dv-charcoal-grey);
                background: var(--dv-light-grey);
            }

            paper-button {
                background: var(--dv-charcoal-grey);
                color: var(--dv-main-background);
            }

            paper-tabs {
                background-color: #afafaf;
                color: #ffffff;
                height: 30px;
                padding: 5px 0px;
            }

            vaadin-grid {
                position: relative;
                height: 100%;
                -webkit-font-smoothing: antialiased;
                --divider-color: #d4d4d4;

                --vaadin-grid-cell: {
                    padding: 0 8px;
                    height: 32px;
                    border-right: 1px solid #d4d4d4;
                    box-sizing: border-box;
                    font-size: 8pt;
                    cursor: default;
                };

                --vaadin-grid-header-cell: {
                    height: 36px;
                    border-bottom: 1px solid #d4d4d4;
                    background-image: linear-gradient(to bottom, #fafafa 2%, #efefef 98%);
                    font-size: 9pt;
                    text-style: bold;
                    text-align: center;
                    cursor: default;
                };

                --vaadin-grid-body-row-odd-cell: {
                    background-color: #f5f5f5;
                };
            }

            .opaque {
                height: 100%;
                opacity: 1.0;
                background: var(--dv-main-background);
                color: var(--dv-main-foreground);
                border: groove;
                border-color: var(--dv-blue-500);
                border-width: thick;
            }

            .poolname {
                color: var(--paper-grey-600);
                margin-top: 20px;
                margin-bottom: 20px;
                padding-left: 10px;
                font-size: 10pt;
                cursor: default;
            }

            .spacer {
                margin-left: 10px !important;
                margin-bottom: 10px;
            }

            input {
                @apply(--layout-flex);
                height: 95%;
                width: 95%;
                padding-right: 5px;
            }

            table {
                margin: 0 100px;
                font-size: 8pt;
            }

            .actionable0 {
                cursor: pointer;
                color: var(--dv-indigo-500);
                -webkit-transition: background 2s; /* Safari */
                transition: background 2s;
            }

            .actionable1 {
                cursor: pointer;
                color: var(--dv-red-500);
                -webkit-transition: background 2s; /* Safari */
                transition: background 2s;
            }

            .actionable0:active {
                color: var(--dv-main-background);
                background: var(--dv-indigo-900);
            }

            .actionable1:active {
                color: var(--dv-main-background);
                background: var(--dv-red-900);
            }

            iron-pages {
                height: 70%;
                width: 100%;
            }

            .tablediv {
                height: 100%;
            }

            .detailinfo {
                margin: 20px auto 20px auto;
            }

        </style>

        <div class="opaque">
            <paper-toolbar>
                <div slot="top" class="spacer title"><strong>Mover & Nearline Info</strong>
                </div>
                <paper-button slot="top" dialog-dismiss>Close</paper-button>
            </paper-toolbar>
            <hr/>
            <div class="poolname"><strong>[[pool]]</strong></div>
            <hr/>
            <paper-tabs selected="{{selected}}" noink="">
                <paper-tab>Movers</paper-tab>
                <paper-tab>P2Ps</paper-tab>
                <paper-tab>Stores/Flushes</paper-tab>
                <paper-tab>Restores/Stages</paper-tab>
                <paper-tab>Removes</paper-tab>
            </paper-tabs>
            <iron-pages selected="{{selected}}">
                <div class="tablediv">
                    <vaadin-grid on-active-item-changed="_activeItemChanged"
                                 aria-label="Movers" id="movers"
                                 active-item="{{activeItem}}"
                                 multi-sort="true" size="[[moversSize]]">
                        <vaadin-grid-column-group>
                            <template class="header">#</template>
                            <vaadin-grid-column width="75px" flex-grow="0">
                                <template class="header">Filter on:</template>
                                <template>[[index]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="pnfsid">
                                    PnfsId
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="250px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="PnfsId"
                                                        path="pnfsid"
                                                        value="[[_filterMoverPnfsId]]">
                                        <input slot="filter"
                                               placeholder="PnfsId"
                                               value="{{_filterMoverPnfsId::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template><span
                                        class$="actionable[[item.pnfsId.active]]">[[item.pnfsId.id]]</span>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="queue">
                                    Queue
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Queue"
                                                        path="queue"
                                                        value="[[_filterMoverQueue]]">
                                        <input slot="filter"
                                               placeholder="Queue"
                                               value="{{_filterMoverQueue::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.queue]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="state">
                                    State
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="State"
                                                        path="state"
                                                        value="[[_filterMoverState]]">
                                        <input slot="filter"
                                               placeholder="State"
                                               value="{{_filterMoverState::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.state]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="mode">
                                    Mode
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="150px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Mode"
                                                        path="mode"
                                                        value="[[_filterMoverMode]]">
                                        <input slot="filter"
                                               placeholder="Mode"
                                               value="{{_filterMoverMode::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.mode]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group resizable>
                            <template class="header">
                                <vaadin-grid-sorter path="door">
                                    Door
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="250px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Door"
                                                        path="door"
                                                        value="[[_filterMoverDoor]]">
                                        <input slot="filter"
                                               placeholder="Door"
                                               value="{{_filterMoverDoor::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.door]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group resizable>
                            <template class="header">
                                <vaadin-grid-sorter path="storageClass">
                                    Class
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="200px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Class"
                                                        path="storageClass"
                                                        value="[[_filterMoverClass]]">
                                        <input slot="filter"
                                               placeholder="Class"
                                               value="{{_filterMoverClass::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.storageClass]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="bytes">MB
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                </template>
                                <template>[[item.bytes.converted]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="timeInSeconds">
                                    Time/Secs
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                </template>
                                <template>[[item.timeInSeconds]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="submitTime">
                                    Submitted
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.submitTime.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="startTime">
                                    Started
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.startTime.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="lastModified">
                                    Last Modified
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.lastModified.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="moverId">Mover Id
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="75px">
                                <template class="header">
                                </template>
                                <template>[[item.moverId]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                    </vaadin-grid>
                </div>
                <div class="tablediv">
                    <vaadin-grid on-active-item-changed="_activeItemChanged"
                                 aria-label="P2Ps" id="p2ps"
                                 active-item="{{activeItem}}"
                                 multi-sort="true" size="[[p2psSize]]">
                        <vaadin-grid-column-group>
                            <template class="header">#</template>
                            <vaadin-grid-column width="75px" flex-grow="0">
                                <template class="header">Filter on:</template>
                                <template>[[index]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="pnfsid">
                                    PnfsId
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="250px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="PnfsId"
                                                        path="pnfsid"
                                                        value="[[_filterP2PsPnfsId]]">
                                        <input slot="filter"
                                               placeholder="PnfsId"
                                               value="{{_filterP2PsPnfsId::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template><span
                                        class$="actionable[[item.pnfsId.active]]">[[item.pnfsId.id]]</span>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="queue">
                                    Queue
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Queue"
                                                        path="queue"
                                                        value="[[_filterP2PsQueue]]">
                                        <input slot="filter"
                                               placeholder="Queue"
                                               value="{{_filterP2PsQueue::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.queue]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="state">
                                    State
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="State"
                                                        path="state"
                                                        value="[[_filterP2PsState]]">
                                        <input slot="filter"
                                               placeholder="State"
                                               value="{{_filterP2PsState::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.state]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group resizable>
                            <template class="header">
                                <vaadin-grid-sorter path="storageClass">
                                    Class
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="200px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Class"
                                                        path="storageClass"
                                                        value="[[_filterP2PsClass]]">
                                        <input slot="filter"
                                               placeholder="Class"
                                               value="{{_filterP2PsClass::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.storageClass]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="bytes">
                                    MB
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                </template>
                                <template>[[item.bytes.converted]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="timeInSeconds">
                                    Time/Secs
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                </template>
                                <template>[[item.timeInSeconds]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="submitTime">
                                    Submitted
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.submitTime.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="startTime">
                                    Started
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.startTime.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="lastModified">
                                    Last Modified
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.lastModified.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="moverId">Mover Id
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="75px">
                                <template class="header">
                                </template>
                                <template>[[item.moverId]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                    </vaadin-grid>
                </div>
                <div class="tablediv">
                    <vaadin-grid on-active-item-changed="_activeItemChanged"
                                 aria-label="Flush" id="flushes"
                                 active-item="{{activeItem}}"
                                 multi-sort="true" size="[[flushesSize]]">

                        <template class="row-details">
                            <div class="details">
                                <table class="detailinfo">
                                    <tr>
                                        <td><strong>UUID:</strong></td>
                                        <td><strong>[[item.uuid]]</strong></td>
                                    </tr>
                                </table>
                            </div>
                        </template>

                        <vaadin-grid-column-group>
                            <template class="header">#</template>
                            <vaadin-grid-column width="75px" flex-grow="0">
                                <template class="header">Filter on:</template>
                                <template>[[index]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">Details</template>
                            <vaadin-grid-column width="50px">
                                <template class="header"></template>
                                <template>
                                    <paper-checkbox aria-label="Details"
                                                    checked="{{expanded}}">
                                    </paper-checkbox>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="pnfsid">
                                    PnfsId
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="250px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="PnfsId"
                                                        path="pnfsid"
                                                        value="[[_filterFlushesPnfsId]]">
                                        <input slot="filter"
                                               placeholder="PnfsId"
                                               value="{{_filterFlushesPnfsId::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template><span
                                        class$="actionable[[item.pnfsId.active]]">[[item.pnfsId.id]]</span>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="state">
                                    State
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="State"
                                                        path="state"
                                                        value="[[_filterFlushesState]]">
                                        <input slot="filter"
                                               placeholder="State"
                                               value="{{_filterFlushesState::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.state]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group resizable>
                            <template class="header">
                                <vaadin-grid-sorter path="storageClass">
                                    Class
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="200px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Class"
                                                        path="storageClass"
                                                        value="[[_filterFlushesClass]]">
                                        <input slot="filter"
                                               placeholder="Class"
                                               value="{{_filterFlushesClass::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.storageClass]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="created">
                                    Created
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.created.formatted]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="activated">
                                    Activated
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.activated.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="totalElapsed">
                                    Total Time (ms)
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template>[[item.totalElapsed]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="running">
                                    Running Time (ms)
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template>[[item.running]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                    </vaadin-grid>
                </div>
                <div class="tablediv">
                    <vaadin-grid on-active-item-changed="_activeItemChanged"
                                 aria-label="Stage" id="stages"
                                 active-item="{{activeItem}}"
                                 multi-sort="true" size="[[stagesSize]]">

                        <template class="row-details">
                            <div class="details">
                                <table class="detailinfo">
                                    <tr>
                                        <td><strong>UUID:</strong></td>
                                        <td><strong>[[item.uuid]]</strong></td>
                                    </tr>
                                </table>
                            </div>
                        </template>

                        <vaadin-grid-column-group>
                            <template class="header">#</template>
                            <vaadin-grid-column width="75px" flex-grow="0">
                                <template class="header">Filter on:</template>
                                <template>[[index]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">Details</template>
                            <vaadin-grid-column width="50px">
                                <template class="header"></template>
                                <template>
                                    <paper-checkbox aria-label="Details"
                                                    checked="{{expanded}}">
                                    </paper-checkbox>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="pnfsid">
                                    PnfsId
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="250px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="PnfsId"
                                                        path="pnfsid"
                                                        value="[[_filterStagesPnfsId]]">
                                        <input slot="filter"
                                               placeholder="PnfsId"
                                               value="{{_filterStagesPnfsId::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template><span
                                        class$="actionable[[item.pnfsId.active]]">[[item.pnfsId.id]]</span>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="state">
                                    State
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="State"
                                                        path="state"
                                                        value="[[_filterStagesState]]">
                                        <input slot="filter"
                                               placeholder="State"
                                               value="{{_filterStagesState::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.state]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group resizable>
                            <template class="header">
                                <vaadin-grid-sorter path="storageClass">
                                    Class
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="200px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Class"
                                                        path="storageClass"
                                                        value="[[_filterStagesClass]]">
                                        <input slot="filter"
                                               placeholder="Class"
                                               value="{{_filterStagesClass::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.storageClass]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="created">
                                    Created
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.created.formatted]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="activated">
                                    Activated
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.activated.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="totalElapsed">
                                    Total Time (ms)
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template>[[item.totalElapsed]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="running">
                                    Running Time (ms)
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template>[[item.running]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                    </vaadin-grid>
                </div>
                <div class="tablediv">
                    <vaadin-grid on-active-item-changed="_activeItemChanged"
                                 aria-label="Remove" id="removes"
                                 active-item="{{activeItem}}"
                                 multi-sort="true" size="[[removesSize]]">

                        <template class="row-details">
                            <div class="details">
                                <table class="detailinfo">
                                    <tr>
                                        <td><strong>UUID:</strong></td>
                                        <td><strong>[[item.uuid]]</strong></td>
                                    </tr>
                                    <tr>
                                        <td><strong>URI:</strong></td>
                                        <td><strong>[[item.uri]]</strong></td>
                                    </tr>
                                </table>
                            </div>
                        </template>

                        <vaadin-grid-column-group>
                            <template class="header">#</template>
                            <vaadin-grid-column width="75px" flex-grow="0">
                                <template class="header">Filter on:</template>
                                <template>[[index]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">Details</template>
                            <vaadin-grid-column width="50px">
                                <template class="header"></template>
                                <template>
                                    <paper-checkbox aria-label="Details"
                                                    checked="{{expanded}}">
                                    </paper-checkbox>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="pnfsid">PnfsId
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="250px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="PnfsId"
                                                        path="pnfsid"
                                                        value="[[_filterRemovesPnfsId]]">
                                        <input slot="filter"
                                               placeholder="PnfsId"
                                               value="{{_filterRemovesPnfsId::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template><span
                                        class$="actionable[[item.pnfsId.active]]">[[item.pnfsId.id]]</span>
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="state">
                                    State
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="State"
                                                        path="state"
                                                        value="[[_filterRemovesState]]">
                                        <input slot="filter"
                                               placeholder="State"
                                               value="{{_filterRemovesState::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.state]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group resizable>
                            <template class="header">
                                <vaadin-grid-sorter path="storageClass">
                                    Class
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="200px">
                                <template class="header">
                                    <vaadin-grid-filter aria-label="Class"
                                                        path="storageClass"
                                                        value="[[_filterRemovesClass]]">
                                        <input slot="filter"
                                               placeholder="Class"
                                               value="{{_filterRemovesClass::input}}"
                                               focus-target>
                                    </vaadin-grid-filter>
                                </template>
                                <template>[[item.storageClass]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="created">
                                    Created
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.created.formatted]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="activated">
                                    Activated
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="175px">
                                <template class="header">
                                </template>
                                <template>[[item.activated.formatted]]
                                </template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="totalElapsed">
                                    Total
                                    Time (ms)
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template>[[item.totalElapsed]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                        <vaadin-grid-column-group>
                            <template class="header">
                                <vaadin-grid-sorter path="running">
                                    Running Time (ms)
                                </vaadin-grid-sorter>
                            </template>
                            <vaadin-grid-column width="100px">
                                <template>[[item.running]]</template>
                            </vaadin-grid-column>
                        </vaadin-grid-column-group>
                    </vaadin-grid>
                </div>
            </iron-pages>
        </div>
    </template>

    <script>
        class PoolActivityDialog extends
            Polymer.mixinBehaviors([Polymer.PaperDialogBehavior, vaadin.elements.grid.CellClickBehavior],
            DcacheViewMixins.AdminAutoRefresh(DcacheViewMixins.AdminBase(Polymer.Element))) {

            static get is() {
                return 'pool-activity-dialog';
            }

            static get properties() {
                return {
                    decorators: {
                        type: Array,
                        value: [{}, {}, {}, {}, {}]
                    },

                    moversSize: {
                        type: Number,
                        value: 0,
                        notify: true
                    },

                    p2psSize: {
                        type: Number,
                        value: 0,
                        notify: true
                    },

                    flushesSize: {
                        type: Number,
                        value: 0,
                        notify: true
                    },

                    stagesSize: {
                        type: Number,
                        value: 0,
                        notify: true
                    },

                    removesSize: {
                        type: Number,
                        value: 0,
                        notify: true
                    },

                    pool: {
                        type: String
                    },

                    pnfsid: {
                        type: String
                    },

                    cell: {
                        type: Number
                    },

                    selected: {
                        type: Number,
                        value: 0,
                        notify: true
                    }
                }
            }

            close() {
                this.stopRefresh();
                this.popDialog();
                super.close();
            }

            connectedCallback() {
                super.connectedCallback();

                this.$.movers.addEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.p2ps.addEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.flushes.addEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.stages.addEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.removes.addEventListener('cell-focus', this._handleCellFocus.bind(this));

                this.decorators[0] = new DvVaadinProviderDecorator(this.$.movers);
                this.decorators[1] = new DvVaadinProviderDecorator(this.$.p2ps);
                this.decorators[2] = new DvVaadinProviderDecorator(this.$.flushes);
                this.decorators[3] = new DvVaadinProviderDecorator(this.$.stages);
                this.decorators[4] = new DvVaadinProviderDecorator(this.$.removes);

                this.$.movers.dataProvider = this._remoteProvider(0).bind(this);
                this.$.p2ps.dataProvider = this._remoteProvider(1).bind(this);
                this.$.flushes.dataProvider = this._remoteProvider(2).bind(this);
                this.$.stages.dataProvider = this._remoteProvider(3).bind(this);
                this.$.removes.dataProvider = this._remoteProvider(4).bind(this);
            }

            constructor(pool, pnfsid) {
                super();
                this.pool = pool;
                this.pnfsid = pnfsid;
                /*
                 *  This property belongs to the Polymer.DialogBehavior.
                 *  We may need to revisit.
                 */
                this.modal = true;
            }

            disconnectedCallback() {
                super.disconnectedCallback();
                this.$.movers.removeEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.p2ps.removeEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.flushes.removeEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.stages.removeEventListener('cell-focus', this._handleCellFocus.bind(this));
                this.$.removes.removeEventListener('cell-focus', this._handleCellFocus.bind(this));
            }

            _handleCellFocus(event) {
                event.stopPropagation();
                this.cell = 0;
                const cell = event.composedPath()[0];
                if (cell) {
                    this.cell = parseInt(cell.order.toString().charAt(0));
                }
            }

            /*
             *  ------ Lazy Load & Infinite Scroll, with Filter & Sort -------
             */

            handleItem(item, index) {
                const mb = 1024 * 1024;
                switch (index) {
                    case 0:
                    case 1:
                        item.pnfsId = this._convertId(item.pnfsId);
                        item.submitTime = this.convertDatestampToObject(item.submitTime);
                        item.startTime = this.convertDatestampToObject(item.startTime);
                        item.lastModified = this.convertDatestampToObject(item.lastModified);
                        if (item.state === 'RUNNING') {
                            item.bytes = this.convertSize(item.bytes, mb);
                        } else {
                            item.bytes = this.convertSize(0, mb);
                            item.timeInSeconds = 0;
                        }
                        break;
                    case 2:
                    case 3:
                    case 4:
                        item.pnfsId = this._convertId(item.pnfsId);
                        item.created = this.convertDatestampToObject(item.created);
                        item.activated = this.convertDatestampToObject(item.activated);
                        break;
                }
                return item;
            }

            itemsArray(xhr, index) {
                return JSON.parse(xhr.responseText);
            }

            providerParams(index) {
                let params = "";

                switch (index) {
                    case 1:
                        params += "&type=p2p-client,p2p-server";
                        break;
                    case 2:
                        params += "&type=flush";
                        break;
                    case 3:
                        params += "&type=stage";
                        break;
                    case 4:
                        params += "&type=remove";
                        break;
                    case 0:
                    default:
                        break;
                }

                return params;
            }

            providerUrl(index) {
                switch (index) {
                    case 0:
                    case 1:
                        return `pools/${this.pool}/movers`;
                    case 2:
                    case 3:
                    case 4:
                        return `pools/${this.pool}/nearline/queues`;
                    default:
                        return null;
                }
            }

            resetTimeout() {
                this.resetRefresh(this._refresh.bind(this), 60000);
            }

            setTableSize(size, index) {
                switch (index) {
                    case 0:
                        this.moversSize = size;
                        break;
                    case 1:
                        this.p2psSize = size;
                        break;
                    case 2:
                        this.flushesSize = size;
                        break;
                    case 3:
                        this.stagesSize = size;
                        break;
                    case 4:
                        this.removesSize = size;
                        break;
                    default:
                        break;
                }
            }

            _convertId(pnfsid) {
                const active = this.pnfsid === pnfsid ? 1 : 0;
                return {"active": active, "id": pnfsid};
            }

            _refresh() {
                this.decorators.forEach((d) => {
                    d.resetProvider(this);
                });
            }

            _remoteProvider(index) {
                return (params, callback) => {
                    return this.decorators[index].runProvider(params,
                        callback,
                        this,
                        index);
                };
            }


            /* -------------------------- Dialogs -------------------------- */

            _activeItemChanged(item) {
                if (item && item.detail && item.detail.value) {
                    this.currentItem = item.detail.value;
                }

                if (typeof this.currentItem === 'undefined' ||
                    typeof this.cell === 'undefined' ) {
                    return;
                }

                if ((this.selected < 2 && this.cell === 2) ||
                    (this.selected > 1 && this.cell === 3)) {
                    this.openFileInfoDialog(this.currentItem.pnfsId.id, this.pool);
                }
            }
        }

        window.customElements.define(PoolActivityDialog.is, PoolActivityDialog);
    </script>
</dom-module>