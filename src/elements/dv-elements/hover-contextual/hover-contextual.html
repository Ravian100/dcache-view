<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../utils/ajax-ls/file-metadata.html">
<dom-module id="hover-contextual">
  <template>
    <style>
      :host {
        display: inline-block;
      }
      paper-icon-button {
        color: #606060;
        width: 30px;
        height: 30px;
      }
      paper-icon-button + paper-icon-button {
        margin-left: -10px !important;
      }
    </style>
    <div>
      <paper-icon-button icon="{{icon}}" title="{{tip}}" id="view"></paper-icon-button>
      <paper-icon-button icon="info" title="metadata information" id="info"></paper-icon-button>
    </div>
  </template>

  <script>
    HoverContextual = Polymer({
      is: 'hover-contextual',

      properties: {
        icon: {
          type: String,
          notify: true
        },

        tip: {
          type: String,
          notify: true
        },

        name: {
          type: String,
          notify: true
        },

        fileType: {
          type: String,
          notify: true
        },

        path: {
          type: String,
          notify: true
        },
      },

      factoryImpl: function(name, fileType, path)
      {
        this.name = name;
        this.fileType = fileType;
        this.path = path;

        switch (fileType) {
          case "DIR":
            this.icon = "visibility";
            this.tip = "open folder";
            break;
          default:
            this.icon = "cloud-download";
            this.tip = "download file";
            break;
        }
      },

      listeners:
      {
        'view.tap': '_view',
        'info.tap': '_info'
      },

      _view: function(e)
      {
        e.stopPropagation();
        //TODO: Factor this function below out. Simply create an element for this sole purpose.
        var x = this.fileType;
        var path;

        if (x == "DIR") {
          path = this.path;
          path = path.replace(/\//g, "=");
          var y = '/home/'+ path;
          page(y);
        } else {
          //Download a file
          var str = window.CONFIG.webdavEndpoint;
          if (str == "") {
            path = window.location.protocol + "//" + window.location.hostname + ":2880" + this.path;
          } else {
            if (str.endsWith("/")) {
              path = str.substring(0, str.length-1) + this.path;
            } else {
              path = str + this.path;
            }
          }
          window.open(path);
        }
        e.stopPropagation();
      },

      _info: function(e)
      {
        e.stopPropagation();
        //TODO: Factor this function below out. Simply create an element for this sole purpose.
        var el1 = new FileMetadata(this.name, this.path, this.fileType);
        app.$.metadataDrawer.innerHTML = "";
        app.$.metadataDrawer.appendChild(el1);
        Polymer.dom.flush();
        app.$.metadata.openDrawer();
        e.stopPropagation();
      }
    });
  </script>
</dom-module>
